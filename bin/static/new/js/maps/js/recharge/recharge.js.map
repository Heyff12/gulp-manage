{"version":3,"sources":["recharge/recharge.js"],"names":["hideMenu","WeixinJSBridge","call","click_chulist","obj","$","addClass","siblings","removeClass","document","addEventListener","attachEvent","require","ajax_rule","screen_button","scr_mobile","src_rule","src_note","body_height","height","fixedb_height","window_height","hide","show","get_rules","return_data_data","return_expired","expired","rules","return_data","each","i","item","return_data_right","present_amt","toFixed","tx_fee","tx_txamt","data_length","length","css","li_detail","tx_index","append","eq","get_rulesdetail","return_data_l","get_merchant","shopname","get_bindinfo","mobile","text","get_bindinfo_error","get_balance","balance","get_pay_money","recharge_num","recharge_url","window","c","get_hash","data_recharge","o","grid_index","attr","get_recharge","location","href","url","get_bindinfo_if","recharge","data_bindinfo","get_bindinfo_if_error","hash_val","c_val","split","url_l_l","url_l","url_val","innerHeight","data_rules","data_rulesdetail","data_merchant","h","data_before","data_balance","on","_hmt","push"],"mappings":";;;;;;YAAA,SAASA,YACLC,eAAeC,KAAK,kBADxBD,eAAAC,KAAoB,eAanB,QAAAC,eAAAC,GACDC,EAAAD,GAAAE,SAAA,aAAAC,SAAA,MAAAC,YAAA,aAZwB,mBAApBP,gBACHQ,SAAAC,iBACGD,SAAOR,iBAAkB,sBAAaD,UAAA,GAClCS,SAASC,cACTD,SAASC,YAAAA,sBAAiBV,UAD9BS,SAEWA,YAASE,wBAAaX,WAGhCA,WAMDK,SAAA,qBAAA,WACHO,SAAA,QAAA,aAAA,SAAAP,EAAAQ,GACOR,EAAC,WA+DI,QAVDS,KAWA,SAAAC,GAAAC,GAAAC,KAGQC,EAAOb,EAAP,QAAAc,cACHD,EAAAE,EAAAC,GAAA,GACDH,EAAAA,oBAAwBC,OACpBD,EAAAA,uBAAcE,OACdf,EAAE,oBAAoBiB,YAAtB,cAEAjB,EAAE,oBAAoBG,OAH1BH,EAAA,uBAIOiB,OACHjB,EAAE,oBAAoBkB,SAAtB,eAIP,QAAAC,GAAAC,GAED,GAAAC,GAAmBD,EAAkBE,OACjC,IAAA,KAAAD,EAGIrB,MAFAqB,GAAAA,eAAiBD,OACjBC,EAAAA,eAAAA,QACE,CAEFrB,GAAA,eAAAiB,OAHJjB,EAAA,eAIOkB,MAEHlB,IAAAA,GAAEoB,EAAFG,MAEAC,IACJxB,GAAAwB,GAAAC,KAAA,SAAAC,EAAAC,GACIC,GAAAA,IAAAA,EAAJF,GAAAG,YAAA,KAAAC,QAAA,GACEN,GAAkBA,EAAAE,GAAYC,QAAM,KAAAG,QAAA,EAC9BC,IAAUP,GAAAA,GAAeK,GACzBG,EAAYR,KAAAA,IAGf,IAAAS,GAAAL,EAAAM,MACJ,OAND,KAAAD,GAOIA,EAAAA,wBAAcL,OAAkBM,IAAAA,UAApC,gBACID,EAAAA,mBAAoBhB,QAClB,IAEFjB,EAAA,wBAAAiB,OAHJjB,EAAA,mBAIOkB,OAAAiB,IAAA,UAAA,gBAEHnC,EAAAA,GAAEyB,KAAmBP,SAArBQ,EAAgCC,GACnC,GAGOK,GAHPD,GAAAH,EAAAF,GAAAG,YAAA,KAAAC,QAAA,GACCF,GAAFA,EAA0BF,GAAYC,QAAM,KAAAG,QAAA,GACpCC,EAAUH,EAAAF,GAAqBG,UAG/BO,GADWR,KAAXS,EACJ,gEAAAA,EAAA,sDAAAL,EAAA,mDAAAD,EAAA,wEACwB,KAApBE,EACY,gEAAkEI,EAAW,sDAAwDL,EAAW,mDAAqDD,EAAS,wEAE9M,iDAAAM,EAAA,sDAA6EL,EAAA,mDAAmED,EAAA,wEAE5JK,EAAAA,kBAAYE,OAAAF,KAEhBpC,EAAAA,qBAAAuC,GAAoBD,GAAAA,SAAOF,aAE/BpC,EAAE,WACFS,MAGH,QAAA+B,GAAApB,GAGG,IAAII,GAFRA,GAAAJ,EACAqB,EAAAjB,EAAyBJ,OACjBI,EAAAA,EAAAA,EAAcJ,EAAlBM,IAAA,CACIe,GAAAA,GAAgBjB,aAAYU,EAAhCR,GAAA,cACA1B,GAAK,sBAAeyC,OAAef,GAGlCd,EAAA,OACDH,IAGH,QAAAiC,GAAAlB,GACD,GAAAmB,GAAAnB,EAAAmB,QACA3C,GAAA,gBAAsBwB,KAAAA,GAGrB,QAAAoB,GAAApB,GACD,GAAAqB,GAAArB,EAAAqB,MACA,OAASD,IAID5C,EAAA,cAAA8C,KAAAD,GAEJ7C,EAAE,WACFS,OANIoC,EAAAA,kBAASrB,QACb,GAQH,QAAAuB,KACD/C,EAAA,kBAAAiB,OAEIjB,EAAE,OACFS,IAGH,QAAAuC,GAAAxB,GACD,GAAAyB,IAAAzB,EAAAyB,QAAA,KAAAnB,QAAA,EACA9B,GAAA,eAAqBwB,KAAAA,GAGpB,QAAA0B,GAAA9B,GACD,GAAAI,GAAAJ,EACA+B,EAAuB/B,EAAAA,SACfI,EAAcJ,EAAAA,GAClB,IAAmBI,KAAf2B,EACAC,OAAAA,SAAe5B,KAAAA,MACf2B,CACAE,GAAAA,IACGC,EAAAC,EAAA,KACCC,EAAAA,EAAAA,KACAC,EAAKF,EAAS,KACdG,WAAc1D,EAAA,+BAFE2D,KAAA,cAIhBnD,GAAAA,UAAgB,6BAAF,OAAsC,OAAAgD,EAAtC,YAAAI,IAIzB,QAAAA,GAAApC,GACD6B,OAAAQ,SAAAC,KAAAtC,EAAAuC,IAGC,QAAAC,GAAAxC,GACD,GAAA2B,GAAA3B,EAAAyC,QACA,IAAA,KAAAd,EACQA,EAAAA,kBAAe3B,OAEfxB,EAAE,OACFS,QACAC,CACAD,GAAAA,IACG6C,EAAAC,EAAA,KAEC/C,GAAK+C,UAAS,8BAAT,MAAA,OAAAW,EAAA,YAAAtB,EAAAG,IAMjB,QAAAoB,KAEIzD,EAAA,OACAA,IAIJ,QAAA6C,GAAAa,GACA,GAAAC,EACI,IAAIA,SAAJP,KAAAQ,MAAA,KAAApC,OAAA,EACI2B,OAAAA,CAIJ,KAAIU,GAFHC,GAAAX,SAAAC,KAAAQ,MAAA,KAAA,GAAAA,MAAA,KACGE,EAAQX,EAAAA,OACRU,EAAAA,EAAUC,EAAMtC,EAApBR,IAAA,CACA,GAAK+C,GAAW/C,EAAI6C,GAApBD,MAAA,IACI,IAAIG,EAAAA,IAAUD,EAEVH,MADAI,GAAQA,EAAML,IA/N5BP,SAAWC,KAAAQ,MAAA,KAAApC,OAAA,GACTlC,EAAA,kBAAA2D,KAAA,OAAA,gCAAAE,SAAAC,KAAAQ,MAAA,KAAA,GAIA,IAAAtD,GAAAqC,OAAAqB,YACA3D,EAAAf,EAAA,oBAAAc,SACIE,EAAAA,EAAgBqC,QAAOqB,SACvB3D,GAAAA,EACAF,GAAAA,EACAH,GAAAA,CAAJV,GAAAI,UACIO,MAAW,WAEbP,GAAAA,IACEkD,EAAAC,EAAA,KACIoB,EAAAA,EAAa,KAEbnE,GAAK+C,UAAS,mCAAT,MAAA,OAAAoB,EAAA,WAAAxD,EAKT,IAAIyD,IADJtB,EAAAC,EAAA,KACIqB,EAAAA,EAAAA,KAEApE,GAAK+C,UAAS,+BAAT,MAAA,OAAAqB,EAAA,YAAApC,EAKT,IAAIqC,IADJC,EAAAvB,EAAA,KAEI/C,GAAK+C,UAAS,kCAAT,MAAA,OAAAsB,EAAA,YAAAnC,EAKT,IAAIqC,IADJzB,EAAAC,EAAA,KACIwB,EAAAA,EAAc,KACdtB,EAAKF,EAAS,KACdG,WAAc,IAEdlD,GAAAA,UAAc,oCAAA,MAAA,OAAAuE,EAAA,YAAAf,EAAAG,EAKlB,IAAIa,IADJ1B,EAAAC,EAAA,KACIyB,EAAAA,EAAAA,KAEAxE,GAAK+C,UAAS,4BAAT,MAAA,OAAAyB,EAAA,YAAAhC,KAGZhD,EApCD,mBAAAiF,GAAA,QAAA,WAqCAC,KAAAC,MAAA,cAAA,WAAA,QAAA,gBAEID,IAAAA,IACA5B,EAAAC,EAAA,KACIwB,EAAAA,EAAc,KACdtB,EAAKF,EAAS,KACdG,WAAc1D,EAAA,+BAFA2D,KAAA,cAIdnD,GAAAA,UAAgB,oCAAoC,MAAA,OAAtCuE,EAAA,YAAA7B","file":"../../../recharge/recharge.js","sourcesContent":["function hideMenu() {\n    WeixinJSBridge.call('hideOptionMenu');\n    WeixinJSBridge.call('hideToolbar');\n}\nif (typeof WeixinJSBridge == \"undefined\") {\n    if (document.addEventListener) {\n        document.addEventListener('WeixinJSBridgeReady', hideMenu, false);\n    } else if (document.attachEvent) {\n        document.attachEvent('WeixinJSBridgeReady', hideMenu);\n        document.attachEvent('onWeixinJSBridgeReady', hideMenu);\n    }\n} else {\n    hideMenu();\n}\n//点击储值项\nfunction click_chulist(obj) {\n    $(obj).addClass('li_choose').siblings('li').removeClass('li_choose');\n};\nrequire(['../require-config'], function() {\n    require([\"zepto\", \"ajax_rule\"], function($, ajax_rule) {\n        $(function() {\n            //修改--储值协议链接\n            if(location.href.split('?').length>1){\n                $('.js_protol_url').attr('href','/prepaid/v1/page/c/pacp.html?'+location.href.split('?')[1]);\n            }\n            //储值首页----------------------------------------------------------------------------------------------------------------------------------------------------\n            //判断屏幕是否超过一屏，按钮是否是固定\n            var window_height = window.innerHeight;\n            var fixedb_height = $('.js_fixed_button').height();\n            var body_height = $('body').height();\n            var scr_mobile = false,\n                src_rule = false,\n                src_note = false;\n            $(document).ready(function() {\n                //获取储值列表todo-show\n                var data_rules = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/rules', 'GET', 'json', data_rules, '.zheceng', get_rules);\n\n                //获取储值规则\n                var data_rulesdetail = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/rulexplain', 'GET', 'json', data_rulesdetail, '.zheceng1', get_rulesdetail);\n\n                //获取商家名称\n                var data_merchant = {\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/merchant_info', 'GET', 'json', data_merchant, '.zheceng1', get_merchant);\n\n                //获取储值账户          \n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': '1',\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_bindinfo_if, get_bindinfo_if_error);\n\n                //获取储值余额\n                var data_balance = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/balance', 'GET', 'json', data_balance, '.zheceng1', get_balance);\n            });\n            //点击购买弹出填写信息——————add_new\n            $('.js_content_sub').on('click', function() {\n                _hmt.push(['_trackEvent', 'recharge', 'click', 'recharge_buy']);\n                //充值前校验\n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_pay_money);\n            });\n            //判断屏幕与按钮的关系\n            function screen_button() {\n                if (!scr_mobile || !src_rule || !src_note) {\n                    return false;\n                }\n                body_height = $('body').height();\n                if (body_height + fixedb_height - window_height >= 0) {\n                    $('.js_fixed_button').hide();\n                    $('.js_relative_button').show();\n                    $('.js_section_mark').removeClass('margin_b');\n                } else {\n                    $('.js_fixed_button').show();\n                    $('.js_relative_button').hide();\n                    $('.js_section_mark').addClass('margin_b');\n                }\n            }\n            //获取储值列表\n            function get_rules(return_data_data) {\n                //验证是否过期\n                var return_expired = return_data_data.expired;\n                if (return_expired == '1') {\n                    $('.js_li_none').show();\n                    $('.js_li_show').hide();\n                    return false;\n                } else {\n                    $('.js_li_none').hide();\n                    $('.js_li_show').show();\n                }\n                var return_data = return_data_data.rules;\n                //获取规则当中储值可用的规则\n                var return_data_right = [];\n                $(return_data).each(function(i, item) {\n                    var tx_fee = (return_data[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data[i].pay_amt / 100).toFixed(0);\n                    if (tx_fee >= 1 && tx_txamt >= 1) {\n                        return_data_right.push(item);\n                    }\n                });\n                var data_length = return_data_right.length;\n                if (data_length == '0') {\n                    $('.js_content_sub_disa').show().css('display', 'inline-block');\n                    $('.js_content_sub').hide();\n                    return false;\n                } else {\n                    $('.js_content_sub_disa').hide();\n                    $('.js_content_sub').show().css('display', 'inline-block');\n                }\n                $(return_data_right).each(function(i, item) {\n                    var tx_fee = (return_data_right[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data_right[i].pay_amt / 100).toFixed(0);\n                    var tx_index = return_data_right[i].grid_index;\n                    var li_detail;\n                    if (data_length == '1') {\n                        li_detail = '<li class=\"li_one\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else if (data_length == '2') {\n                        li_detail = '<li class=\"li_two\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else {\n                        li_detail = '<li onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    }\n                    $(\".js_rechage_ul\").append(li_detail);\n                });\n                $(\".js_rechage_ul li\").eq(0).addClass('li_choose');\n                //成功后重新判断body高度\n                src_rule = 'ture';\n                screen_button();\n            }\n            //获取储值规则\n            function get_rulesdetail(return_data_data) {\n                var return_data = return_data_data;\n                var return_data_l = return_data.length;\n                for (var i = 0; i < return_data_l; i++) {\n                    var li_detail = '<li><span>' + return_data[i] + '</span></li>';\n                    $(\".js_note_ul_detail\").append(li_detail);\n                }\n                //成功后重新判断body高度\n                src_note = 'ture';\n                screen_button();\n            }\n            //获取商家名称\n            function get_merchant(return_data) {\n                var shopname = return_data.shopname;\n                $('.js_shopname').text(shopname);\n            }\n            //获取储值账户\n            function get_bindinfo(return_data) {\n                var mobile = return_data.mobile;\n                if (!mobile) {\n                    $('.js_mobilehang').hide();\n                    return false;\n                }\n                $('.js_mobile').text(mobile);\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取储值账户失败\n            function get_bindinfo_error() {\n                $('.js_mobilehang').hide();\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取余额\n            function get_balance(return_data) {\n                var balance = (return_data.balance / 100).toFixed(2);\n                $('.js_balance').text(balance);\n            }\n            //点击购买\n            function get_pay_money(return_data_data) {\n                var return_data = return_data_data;\n                var recharge_num = return_data.recharge;\n                var recharge_url = return_data.url;\n                if (recharge_num == '0') {\n                    window.location.href = recharge_url;\n                } else {\n                    var data_recharge = {\n                        'c': get_hash('c'),\n                        'h': get_hash('h'),\n                        'o': get_hash('o'),\n                        'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index'),\n                    };\n                    ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge', 'POST', 'json', data_recharge, '.zheceng2', get_recharge);\n                }\n            }\n            //提交充值\n            function get_recharge(return_data) {\n                window.location.href = return_data.url;\n            }\n            //判断是否调用--储值账户\n            function get_bindinfo_if(return_data) {\n                var recharge_num = return_data.recharge;\n                if (recharge_num == '0') {\n                    $('.js_mobilehang').hide();\n                    //根据储值账户现实与否--重新判断body高度\n                    scr_mobile = 'ture';\n                    screen_button();\n                } else {\n                    var data_bindinfo = {\n                        'c': get_hash('c'),\n                    };\n                    ajax_rule.ajax_rule(' /prepaid/v1/api/c/bindinfo', 'GET', 'json', data_bindinfo, '.zheceng1', get_bindinfo, get_bindinfo_error);\n                }\n\n            }\n            //\n            function get_bindinfo_if_error() {\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //通用--------------------------------------------------------------------------------------------------------\n            //获取url的指定hash值\n            function get_hash(hash_val) {\n                var c_val;\n                if (location.href.split('?').length < 2) {\n                    return false;\n                }\n                var url_l = location.href.split('?')[1].split('&');\n                var url_l_l = url_l.length;\n                for (var i = 0; i < url_l_l; i++) {\n                    var url_val = url_l[i].split('=');\n                    if (url_val[0] == hash_val) {\n                        c_val = url_val[1];\n                        return c_val;\n                    }\n                }\n            }\n        })\n    });\n});\n"]}